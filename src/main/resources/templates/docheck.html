<html xmlns:th="http://www.thymeleaf.org">

<header>
    <script src="/assets/jquery-3.1.1.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            $("li.hostToCheck").each(function (index, element) {
                var hostName = $(element).children("span.hostName").first().text();
                var hostPort = $(element).children("span.hostPort").first().text();
                var resultElement = $(element).children("span.urlCheckResult").first();
                checkUrlAjaxy(hostName, hostPort, resultElement);


            });
        });

        function checkUrlAjaxy(hostName, hostPort, resultElement) {
            $.ajax({

                // The URL for the request
                url: "testconn",

                // The data to send (will be converted to a query string)
                data: {
                    host: hostName,
                    port: hostPort
                },

                // Whether this is a POST or GET request
                type: "GET",

                // The type of data we expect back
                dataType: "json"
            })
            // Code to run if the request succeeds (is done);
            // The response is passed to the function
                    .done(function (json) {
                        $.each(json, function (i, field) {
                            resultElement.append(field + " ")
                        });

                    })
                    // Code to run if the request fails; the raw request and
                    // status codes are passed to the function
                    .fail(function (xhr, status, errorThrown) {
                        alert("Sorry, there was a problem!");
                        console.log("Error: " + errorThrown);
                        console.log("Status: " + status);
                        console.dir(xhr);
                    })
                    // Code to run regardless of success or failure;
                    .always(function (xhr, status) {

                    });

        }
    </script>
</header>
<body>

<div th:if="${message}">
    <h2 th:text="${message}"/>
</div>

<div>
    <ul>
        <li class="hostToCheck" th:each="hostPort : ${connectionToChecks}">
            <span class="hostName" th:text="${hostPort.host}">dummyhost</span>:<span class="hostPort"
                                                                                     th:text="${hostPort.port}"></span>
            <span class="urlCheckResult"></span>
        </li>
    </ul>
</div>


</body>
</html>